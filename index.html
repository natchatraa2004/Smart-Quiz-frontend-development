<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Quiz App - Login</title>

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <link rel="stylesheet" href="style.css" />
  </head>
  <body
    class="bg-light d-flex align-items-center justify-content-center vh-100"
  >
    <div class="card shadow-sm p-4 rounded-4" style="width: 380px">
      <h2 class="text-center mb-3">Welcome to Smart Quiz</h2>
      <form id="loginForm">
        <div class="mb-3">
          <label class="form-label">Your Name</label>
          <input
            id="nameInput"
            class="form-control"
            placeholder="Enter your name"
            required
          />
        </div>

        <div class="d-grid gap-2">
          <button type="submit" class="btn btn-primary">Start</button>
          <button
            type="button"
            id="directBtn"
            class="btn btn-outline-secondary"
          >
            Open Quiz (if already logged in)
          </button>
        </div>
      </form>

      <div class="text-center mt-3 small text-muted">
        Your name will be stored locally for leaderboard & resume.
      </div>
    </div>

    <script>
      // Storage system with fallback
      const createStorage = () => {
        try {
          localStorage.setItem("test", "test");
          localStorage.removeItem("test");
          return localStorage;
        } catch (e) {
          console.warn("localStorage not available, using memory storage");
          return {
            data: {},
            setItem: function (key, value) {
              this.data[key] = value;
            },
            getItem: function (key) {
              return this.data[key] || null;
            },
            removeItem: function (key) {
              delete this.data[key];
            },
          };
        }
      };

      const storage = createStorage();

      // Simple login: save username and go to quiz.html
      const loginForm = document.getElementById("loginForm");
      const directBtn = document.getElementById("directBtn");

      loginForm.addEventListener("submit", (e) => {
        e.preventDefault();
        const name = document.getElementById("nameInput").value.trim();
        if (!name) {
          alert("Please enter your name");
          return;
        }

        // Store username
        try {
          storage.setItem("quiz.username", name);
        } catch (e) {
          console.warn("Storage failed:", e);
        }

        // Redirect to quiz page
        window.location.href = "quiz.html";
      });

      directBtn.addEventListener("click", () => {
        let savedUser;
        try {
          savedUser = storage.getItem("quiz.username");
        } catch (e) {
          savedUser = null;
        }

        if (savedUser) {
          window.location.href = "quiz.html";
        } else {
          alert("No saved login found. Please enter your name first.");
        }
      });

      // Check if coming back from quiz page
      window.addEventListener("pageshow", function (event) {
        const nameInput = document.getElementById("nameInput");
        const savedUser = storage.getItem("quiz.username");
        if (savedUser && nameInput) {
          nameInput.value = savedUser;
        }
      });
    </script>
  </body>
</html>
